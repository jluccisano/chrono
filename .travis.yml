language: node_js
sudo: required
node_js:
- '7'
services:
- docker
cache:
  directories:
  - node_modules
before_install:
- npm i -g npm@^5.3.0
install:
- npm install
- npm run build
script:
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH;
  fi`
- docker build -t $REPO:$TAG .
after_success:
- docker login -u $DOCKER_USER -p $DOCKER_PASSWORD
- docker tag $REPO:$COMMIT $REPO:$TAG
- docker tag $REPO:$COMMIT $REPO:$TRAVIS_BUILD_NUMBER
- docker push $REPO
deploy:
  provider: releases
  api_key:
    secure: XtPXmMfl0xaedXcUqHLdl9qBxAY5YH6pMvAvt2cRLYd/rBsV2gTpIrIPRI6tnbh6WSB4KlwnI8F9Q+w4Y9WEnuEVmYeDkJCJplg9P1m5nsTgT0RoIlHfERrOyqLh0YIC6reRiAFRcusMXcMa7ONVMgFrG/i4DGlbGOmsGAn/5NRp2LU7HS96ITwsdmmJQS4HIFj6wJvngHMdIYUJxl2qaYqNKjuyZgZND1aKwYbm1w1NetNFA1IL40j59+N/SL0qbVvB/eNzFuKwKd5cIOXqO8T/LeZkcuWdpj8wnbL9wnWfbchyOSt8R0Lw4LjbtKzGsydMNtJG/ySbdvrbs9CIdYPNsVQ+cJjAyNQJfnUZCE9CzzCB280/UhVIrOmyruZaecTosmFmImNwaqRw+anNOO0lU+/HSM+JV7glUQB+9wG5FhmvWx98MYlNXb0T2tdvHPa9t7NNpYYyNIF206cCTX00W66cpLbQU+Smu5I1fmsZdpy6kcH26nuumXyd7j0IZXy4AcG27QwReRIBmyg+TfPLkCj+bhCxTUEb9GYGVIvXMnvu35BgDnDS6P5aWEiHvUln3zvopv7gtoq+dnkAioQ3t3Uo6XL2vxodOUcP7mLcY1pE2kDussI6TqgwnqlPgb65Vtig8VWUu3r7p0+FI3lSRUdlPf3DqDqfDSy0y9Y=
  file: dist/chrono.zip
  skip_cleanup: true
  on:
    tags: true
    repo: "$REPO"
env:
  global:
  - secure: ySFWlL/qIB1wALj/MwRJ9V9eNlj3WqLX/WnVA91ko2Yt9Iw4/SvGHIEJ/LgXox5hh2EtHNYa9p/82UZBqVz7IPjfYXu87fsKxm2J+hP3K+xAwELeVxZHTBgPfKxpdzjjW6owg2BX2HDt9vsnUDZKKVsWug9ST2kRSHB6soTD45yM2zq4QukxTmzsshcckQTWdYV7Uhp4EVpSbBdKFGeS9RKs5tip0vE+VxZmKRlnxTxdVK/4TEK6w5yHD1wk/H+0KG/RT+D7eWdtON877xpu1o1rjAe+4tq4XPdEPU/d1VfI0gf6/MVlK4Q2/pON8eHlUjmkfqcuZcvEXGaNcT+v2qXE4ev/sSLTP4mPPtSzrYEVwipMddZkFY+QIOiYntgIlw07KbN1VuxGMvFfF36iPykpikrLh8EkTWg69XIdOt7uEsM48mg0C7yCDcu9fKOHogbClFuAPSpbTimLI7Cxf7tYV7VKBY13cDgcskTCExjRGzcCXGb69Qp3hnzYLBrPCxR8MgjVj3q2PE3is/VVBzXp2dEP6MnHvChuMlw+5oJ33yJE+tRSTWUBCjorCznCgDv1A062OhNxtH9fBTmPYMjbcbe8qSIvgSAW0ldeKU0BmF5nxIllkLTLo8D63Y5fhS9uS0ZDVnoEJ3FQew6czCVGkCpbxpkPlzZPJVRgVA8=
  - secure: E+ovMQf3bgfenlZ0ZdmwXPBxReviER0k+qBMeu5jwZhvxwq3uAJtZHAvYWGSuqDi+L7HMBjnCrTrqot84DEC7fgOOi0W7nH4AGH+MaVkpzsjwWjmrBkLy0+lqsluVxLMuNSpTXgtna4cbDm72VITtLlaIXnAN46X2K6C6tmCFzfftyWqJBhRwZbqeQU98lAMEEEnVjDZ/a2yjGwas75WQ+b4tF+5Bag2zA7btIw5JR5DkDvHr4VIzCFubncIYjZNZJnGorEzi5H7GSyg9xXfTSNscfDKmN0bUBGo6rlrMAVLDtuenKDWv9lOvuF+1491ZZcFdM2W4xjCpNCwpT3jDGaAZkBiCnzbaKMrj0txNu1Dkl1MHE2OhAoGi92jpJfU7J1luia1lahx6X7Bin+9lhgZVtE82VlZ1xD3IqLZLEgVUfg1mpz+o1Z2/mi+nAdtglJHpPnx/nOvGCzJW4FK3QTkVePzVkC8b8fuIXPOwG9m6OfOSziKfipnF8TFqTWxuYuqCFeOXSSaStxijaU5TzzcGChfR5bX6uXBzdUT0+96Q2u1H7Kn7BwKTJsgOC7zjuOU2wD38vSuC34hRXuSEXH0b92PI9w9yweimo+FjSinRz9FvuhqIdBEou8aNgfpgYTW0pUzWcRZk9SH3v6xmX2ly1GWilsyhe/VKphKf9w=
  - COMMIT=${TRAVIS_COMMIT::8}
  - REPO=$DOCKER_USER/chrono
